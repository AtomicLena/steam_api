<!-- header _________________________________________________________________________ -->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" rel="stylesheet" />
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" rel="stylesheet" />
    <!-- MDB -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/3.3.0/mdb.min.css" rel="stylesheet" />
    <!-- CSS de DataTable -->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.24/css/jquery.dataTables.css">
    <title>Saturn Store</title>
</head>

<body>
    <div style="background-color: #690a4f; line-height:20px;">
        <br>
    </div>
    <header>
        <nav class="navbar navbar-expand-lg navbar-dark text-white" style="background-color: #9a3f7b;">
            <!-- Container wrapper -->
            <div class="container-fluid">
                <p>&nbsp</p>
                <img style="max-width: 2.5%;  height: auto;" href="index.html" src="https://cdn.discordapp.com/attachments/382531406276067328/841913273821167646/saturn_logo.png">
                <br>
                <!-- Navbar brand -->

                <a class="navbar-brand navbarfont" href="index.html"> &nbsp &nbsp Store</a>
                <!-- Toggle button -->
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <!-- Left links -->
                    <ul class="navbar-nav me-auto mb-2 mb-lg-0 navbar-brand">
                        <li class="nav-item">
                            <a class="nav-link active" aria-current="page" href="games_manager.html">&nbspGames Management</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" aria-current="page" href="usr_manager.html">&nbsp&nbspUsers Management</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>

    <!-- header _________________________________________________________________________ -->

    <!-- body _________________________________________________________________________ -->

    <head>
        <link rel="stylesheet" href="styles.css">
    </head>
    <style>
        table,
        th,
        td {
            border: 1px solid black;
            border-collapse: collapse;
        }
        
        th,
        td {
            padding: 5px;
        }
        
        h1 {
            display: inline;
        }
    </style>

    <body>

        <div class="divthings">
            <div class="inlinecat" style="display: flex; align-items: center">
                <h1>Games Management &nbsp</h1>
                <img class="logo" src="https://cdn0.iconfinder.com/data/icons/retro-items-4/64/Game_Controller-512.png">

            </div>
            <table class="table table-hover table-borderless display nowrap align-middle" id="gamesearch">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th style='max-width: 150px;'>Description</th>
                        <th>Price</th>
                        <th>Release Date</th>
                        <th>Options</th>
                    </tr>
                </thead>
            </table>
            <button type="button" class="btn addbutton" data-mdb-toggle="modal" data-mdb-target="#modalaad">
            Add a new game
        </button>
        </div>
        <!-- botoneeeeeeeeeeeeeeeeeeeeeees -->


        <!-- modal edit -->
        <div class="modal fade" id="modaledit" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">

                    <div class="modal-header">
                        <h5 class="modal-title" id="gametitlem">Game name</h5>
                        <button type="button" class="btn-close" data-mdb-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body container" id="bodymodalshow">
                        <form id="geForm">
                            <input type="hidden" name="id" id="geId" />
                            <!-- Name input -->
                            <div class="form-outline mb-4">
                                <input type="name" name="gname" id="geName" class="form-control" />
                                <label class="form-label" for="geName">Name</label>
                            </div>

                            <!-- Price input -->
                            <div class="form-outline mb-4">
                                <input type="number" name="gprice" id="gePrice" class="form-control" />
                                <label class="form-label" for="gePrice">Price</label>
                            </div>
                            <!-- Description input -->
                            <div class="form-outline mb-4">
                                <textarea rows="3" name="gdesc" id="geDesc" class="form-control"></textarea>
                                <label class="form-label" for="geDesc">Description</label>
                            </div>
                            <!-- Cover input -->
                            <div class="form-outline mb-4">
                                <input type="text" name="gcover" id="geCover" class="form-control" />
                                <label class="form-label" for="geCover">Game cover</label>
                            </div>

                            <!-- Submit button -->
                            <button type="submit" class="btn btn-block">Save Changes</button>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-mdb-dismiss="modal">Discard</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- modal delete -->
        <div class="modal fade" id="modaldel" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="gametitlem">Delete gamename</h5>
                        <button type="button" class="btn-close" data-mdb-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body container" id="bodymodalshow">
                        Are you sure you want to delete gamename?
                        <form id="gdForm">
                            <input type="hidden" name="id" id="gdId" />
                            <button type="submit" class="btn btn-primary">Yes</button>
                            <button type="button" data-mdb-dismiss="modal" class="btn btn-danger">No</button>
                        </form>

                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-mdb-dismiss="modal">Discard</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- modal add -->
        <div class="modal fade" id="modalaad" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">

                    <div class="modal-header">
                        <h5 class="modal-title" id="gametitlem">Adding a new game</h5>
                        <button type="button" class="btn-close" data-mdb-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body container" id="bodymodalshow">
                        <form id="giForm">
                            <div class="form-outline mb-4">
                                <input type="text" name="gname" id="form1Example1" class="form-control" />
                                <label class="form-label" for="form1Example1">Name</label>
                            </div>

                            <!-- Price input -->
                            <div class="form-outline mb-4">
                                <input type="number" name="gprice" id="form1Example2" class="form-control" />
                                <label class="form-label" for="form1Example2">Price</label>
                            </div>
                            <!-- Description input -->
                            <div class="form-outline mb-4">
                                <textarea rows="3" name="gdesc" id="geDesc" class="form-control"></textarea>
                                <label class="form-label" for="form1Example2">Description</label>
                            </div>
                            <!-- Cover input -->
                            <div class="form-outline mb-4">
                                <input type="text" name="gcover" id="form1Example2" class="form-control" />
                                <label class="form-label" for="form1Example2">Game cover</label>
                            </div>
                            <!-- Submit button -->
                            <button type="submit" class="btn btn-block">Save Changes</button>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-mdb-dismiss="modal">Do not add</button>
                    </div>
                </div>
            </div>
        </div>
    </body>

    <!-- body _________________________________________________________________________ -->

    <!-- footer _________________________________________________________________________ -->
    <footer class="footer-dark text-white text-center fixed-bottom text-lg-start" style="background-color: #9a3f7b;">

        <!-- Copyright -->
        <div class="text-center p-3" style="background-color: rgba(0, 0, 0, 0);">
            © 2021 Copyright: Héctor Lopez Lara
        </div>
        <!-- Copyright -->
    </footer>
    <!-- Footer -->
    <!-- MDB -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/3.3.0/mdb.min.js"></script>
    <!-- JS de DataTable -->
    <script type="text/javascript" charset="utf8" src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.24/js/jquery.dataTables.js"></script>

    <script>
        $(document).ready(function() {
            gamestable()
            userstable()
            $('#gamus').DataTable({
                "scrollY": "550px",
                "scrollCollapse": true,
                "ordering": true,
                "paging": true,
                "searching": true
            });
            /* games table */
            $('#gamesearch').DataTable({
                "scrollY": "250px",
                "scrollCollapse": true,
                "paging": true,
                "searching": true,
                "order": [],
                aoColumns: [{
                    mData: 'GAME_ID'
                }, {
                    mData: 'GAME_NAME'
                }, {
                    mData: 'GAME_DESCRIP'
                }, {
                    mData: 'GAME_PRICE'
                }, {
                    mData: 'RELEASEDATE'
                }, {
                    mData: 'BUTTONS'
                }, ],
            });
            /* users table */
            $('#usersearch').DataTable({
                "scrollY": "250px",
                "scrollCollapse": true,
                "paging": true,
                "searching": true,
                "order": [],
                aoColumns: [{
                        mData: 'USR_ID'
                    }, {
                        mData: 'USR_NICKNAME'
                    }, {
                        mData: 'USR_EMAIL'
                    }, {
                        mData: 'USR_LVL'
                    }, {
                        mData: 'USR_CREATION'
                    },
                    /* { mData: 'GAMES_OWNED' }, */
                    {
                        mData: 'BUTTONS'
                    },
                ],
            });

            welcome();
            /* Cargar imagenes y datos menu principal*/
            function welcome() {
                $.ajax({
                    type: "GET",
                    url: 'https://itp-sd.site/hll/Steam%20API/api%20files/showgames.php',
                    data: {},
                    success: function(response) {
                        let card = "";
                        response.result.forEach(function(game) {
                            card += "<div class='col-2 mb-3'>" +
                                "<div class='card'>" +
                                "<a onclick='showcasemodal(" + game.GAME_ID + ")'>" +
                                "<img src='" + game.GAME_COVER + "'class='card-img-top img-game'/>" +
                                "</a>" +
                                "<div class='card-body'>" +
                                "<p class='card-text'>" + game.GAME_NAME + "</p>" +
                                "</div>" +
                                "</div>" +
                                "</div>";
                        });
                        $("#gamecards").html(card);
                    }
                });
            }

            /*     funciones para borrar insertar, etc los juegos ____________________________________________*/
            $("#geForm").submit(function(e) {
                e.preventDefault();
                $.ajax({
                    type: "POST",
                    url: 'https://itp-sd.site/hll/Steam%20API/api%20files/gameupdate.php',
                    data: $(this).serialize(),
                    success: function(response) {
                        //console.log(response);
                        gamestable();
                    }
                });
            });

            $("#giForm").submit(function(e) {
                e.preventDefault();
                $.ajax({
                    type: "POST",
                    url: 'https://itp-sd.site/hll/Steam%20API/api%20files/gameinsert.php',
                    data: $(this).serialize(),
                    success: function(response) {
                        gamestable();
                    }
                });
            });

            $("#gdForm").submit(function(e) {
                e.preventDefault();
                $.ajax({
                    type: "POST",
                    url: 'https://itp-sd.site/hll/Steam%20API/api%20files/gamedelete.php',
                    data: $(this).serialize(),
                    success: function(response) {
                        gamestable();
                    }
                });
            });




            /*     funciones para borrar insertar, etc los usuarios ____________________________________________*/
            $("#ueForm").submit(function(e) {
                e.preventDefault();
                $.ajax({
                    type: "POST",
                    url: 'https://itp-sd.site/hll/Steam%20API/api%20files/userupdate.php',
                    data: $(this).serialize(),
                    success: function(response) {
                        //console.log(response);
                        userstable();
                    }
                });
            });

            $("#uiForm").submit(function(e) {
                e.preventDefault();
                $.ajax({
                    type: "POST",
                    url: 'https://itp-sd.site/hll/Steam%20API/api%20files/userinsert.php',
                    data: $(this).serialize(),
                    success: function(response) {
                        userstable();
                    }
                });
            });

            $("#udForm").submit(function(e) {
                e.preventDefault();
                $.ajax({
                    type: "POST",
                    url: 'https://itp-sd.site/hll/Steam%20API/api%20files/userdelete.php',
                    data: $(this).serialize(),
                    success: function(response) {
                        userstable();
                    }
                });
            });



        });
        /* Cargar imagenes y datos para los modals del main page*/
        function showcasemodal(id) {
            console.log(`accedí al id: ${id}`);
            $("#exampleModal").modal("show");
            $.ajax({
                type: "GET",
                url: 'https://itp-sd.site/hll/Steam%20API/api%20files/gamedetail.php?id=' + id,

                success: function(response) {
                    $("#gametitlem").text(response.result[0].GAME_NAME);
                    $("#bodymodalshow").html(`
            <img class="center" style=" object-fit: cover; object-position: center; width: 100%; height: calc( 40vh - ( (1.275rem + .3vw) * 5)); border-radius: 5px;" src="${response.result[0].GAME_COVER}">
            <h1 style="margin-top: 15px">${response.result[0].GAME_NAME}</h1>
            <h4 class="description">Price: ${response.result[0].GAME_PRICE}</h4>
            <h4 class="description">Added to the store on: ${response.result[0].RELEASEDATE}</h4><br>
            <p style="text-align: justify!important; text-justify: inter-word!important; font-size:125%">${response.result[0].GAME_DESCRIP}</p>
            `);
                }
            });
        }

        /* relleno de tablaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaas */

        /* cosas de los juegos_______________________________________________________*/
        function gamestable() {
            $.ajax({
                type: "GET",
                url: 'https://itp-sd.site/hll/Steam%20API/api%20files/showgames.php',
                data: {},
                success: function(response) {
                    console.log(response.result)
                        /* var jsonData = JSON.parse(response); */
                    if (response.success) {
                        response.result.forEach(row => {
                            row.BUTTONS = "<button class='btn' data-mdb-toggle='modal' data-mdb-target='#modaledit' onclick='gamestablefilledit(" + row.GAME_ID + ")'>Editar</button>&nbsp;" +
                                "<button class='btn' data-mdb-toggle='modal' data-mdb-target='#modaldel' onclick='gamestabledeletemodal(" + row.GAME_ID + ")'>Eliminar</button>";
                            row.GAME_DESCRIP = `<span class='d-inline-block text-truncate' style='max-width: 150px;'>${row.GAME_DESCRIP}</span>`;
                        });
                        /* VER QUE VERGA */
                        $("#gamesearch").DataTable().clear();
                        $("#gamesearch").DataTable().rows.add(response.result).draw();
                    }
                }
            });
        }

        function gamestablefilledit(gameid) {
            $.ajax({
                type: "GET",
                url: 'https://itp-sd.site/hll/Steam%20API/api%20files/gamedetail.php?id=' + gameid,
                data: {},
                success: function(response) {
                    console.log(response.result)
                        /* var jsonData = JSON.parse(response); */
                    if (response.success) {
                        $("#geId").val(gameid);
                        $("#geName").val(response.result[0].GAME_NAME);
                        $("#gePrice").val(response.result[0].GAME_PRICE);
                        $("#geDesc").val(response.result[0].GAME_DESCRIP);
                        $("#geCover").val(response.result[0].GAME_COVER);
                    }
                }
            });
        }

        function gamestabledeletemodal(gameid) {
            $("#gdId").val(gameid);
        }

        /* cosas de los usuarios_______________________________________________________*/
        function userstable() {
            $.ajax({
                type: "GET",
                url: 'https://itp-sd.site/hll/Steam%20API/api%20files/showusers.php',
                data: {},
                success: function(response) {
                    console.log(response.result)
                        /* var jsonData = JSON.parse(response); */
                    if (response.success) {
                        response.result.forEach(row => {
                            row.BUTTONS = "<button class='btn' data-mdb-toggle='modal' data-mdb-target='#modaledit' onclick='gamestablefilledit(" + row.USR_ID + ")'>Editar</button>&nbsp;" +
                                "<button class='btn' data-mdb-toggle='modal' data-mdb-target='#modaldel' onclick='gamestabledeletemodal(" + row.USR_ID + ")'>Eliminar</button>";
                            /* row.GAME_DESCRIP = `<span class='d-inline-block text-truncate' style='max-width: 150px;'>${row.GAME_DESCRIP}</span>`; */
                        });
                        $("#usersearch").DataTable().clear();
                        $("#usersearch").DataTable().rows.add(response.result).draw();
                    }
                }
            });
        }

        function gamestablefilledit(usrid) {
            $.ajax({
                type: "GET",
                url: 'https://itp-sd.site/hll/Steam%20API/api%20files/userdetail.php?id=' + usrid,
                data: {},
                success: function(response) {
                    console.log(response.result)
                        /* var jsonData = JSON.parse(response); */
                    if (response.success) {
                        $("#ueId").val(usrid);
                        $("#ueName").val(response.result[0].USR_NICKNAME);
                        $("#ueEmail").val(response.result[0].USR_EMAIL);
                        $("#ueLVL").val(response.result[0].USR_LVL);
                        $("#uePFP").val(response.result[0].USR_PFP);
                    }
                }
            });
        }

        function usertabledeletemodal(usrid) {
            $("#udId").val(usrid);
        }
    </script>
</body>

</html>